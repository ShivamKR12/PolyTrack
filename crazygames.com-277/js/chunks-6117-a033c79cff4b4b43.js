try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="160f60fe-9718-44b8-affb-90284a255b83",e._sentryDebugIdIdentifier="sentry-dbid-160f60fe-9718-44b8-affb-90284a255b83")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:crazygames-portal":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6117],{57440:(e,t,i)=>{i.d(t,{g:()=>X,A:()=>et});var s,r,n,a=i(74848),o=i(96540),d=i(35265),l=i(74959);let h=null;var u=i(59386),c=i(66961),m=i(38037),g=i(39115),f=i(36797),p=i(40499),v=i(8056),w=i(46069);let b=[{width:1910,height:970},{width:1360,height:660},{width:1370,height:650},{width:1370,height:620},{width:1530,height:750},{width:1360,height:650},{width:1910,height:940},{width:1370,height:660},{width:1360,height:630},{width:1080,height:710},{width:1920,height:970},{width:1360,height:620},{width:1910,height:960},{width:1370,height:670},{width:1530,height:710},{width:1910,height:930},{width:1370,height:630},{width:1920,height:940},{width:390,height:660}];var y=i(8379),C=i(95613),k=i(75782);class T{constructor(e){this.id=e,this.previousTimeInView=0,this.isInView=!1,this.isInFocus=!0,this.isHidden=!1,this.inViewSince=Date.now(),this.inDOMSince=this.inViewSince}setHidden(e){this.isHidden=e}canRefresh(e,t){return this.isInView&&this.isInFocus&&this.totalTimeInView()>=e&&this.totalTimeInDOM()>=t}refreshed(){this.previousTimeInView=0,this.inViewSince=Date.now(),this.inDOMSince=this.inViewSince}cameIntoView(){this.isInView=!0,this.inViewSince=Date.now()}removedFromView(){this.isInView=!1,this.updateTimeInView()}pageLostFocus(){this.isInFocus=!1,this.isInView&&this.updateTimeInView()}pageRegainedFocus(){this.isInFocus=!0,this.isInView&&(this.inViewSince=Date.now())}updateTimeInView(){let e=Date.now()-this.inViewSince;this.previousTimeInView+=e,this.inViewSince=Date.now()}totalTimeInDOM(){return Date.now()-this.inDOMSince}totalTimeInView(){return this.isInView?this.previousTimeInView+Date.now()-this.inViewSince:this.previousTimeInView}}class A{constructor(e,t){this.viewportThreshold=e,this.minimumTimeInViewInMs=t,this.handleVisibilityChange=()=>{let e=void 0!==this.hiddenKey&&this.isHidden(document,this.hiddenKey),t=k.A.isFullscreen()||k.A.isFakeFullscreen();e||t?this.pageLostFocus():this.pageRegainedFocus()},this.handleFullscreenChange=()=>{k.A.isFullscreen()||k.A.isFakeFullscreen()?this.pageLostFocus():this.pageRegainedFocus()},this.adUnits=[],this.hiddenKey=this.calculateHiddenKey(document),this.observer=this.createObserver(),this.installEventListeners(),this.pageFocusChangeCallBacks=[],this.ioCallbackPending=[],this.ioCallbackPendingPromise=null,this.ioCallbackPendingResolve=null}calculateHiddenKey(e){return void 0!==e.hidden?"hidden":this.hasMsHiddenKey(e)?"msHidden":this.hasWebkitHiddenKey(e)?"webkitHidden":void 0}getVisibilityChangeKey(e){switch(e){case"hidden":return"visibilitychange";case"msHidden":return"msvisibilitychange";case"webkitHidden":return"webkitvisibilitychange"}}addElement(e){if(this.adUnits.find(t=>t.id===e))return;let t=this.getElementById(e);if(!t)return;this.ioCallbackPending.push(e),this.adUnits.push(new T(e));let i=t.parentElement;i&&this.observer.observe(i)}removeElement(e,t){this.adUnits=this.adUnits.filter(t=>t.id!==e),t&&t.parentElement&&this.observer.unobserve(t.parentElement),this.removeWaitingForCallbackElement(e)}addPageFocusChangeCallback(e){this.pageFocusChangeCallBacks.push(e)}stop(){this.adUnits=[],this.pageFocusChangeCallBacks=[],this.observer.disconnect(),this.removeEventListeners()}waitForObservedUnitsCallbacks(){return this.ioCallbackPendingPromise||(this.ioCallbackPendingPromise=new Promise(e=>{this.ioCallbackPendingResolve=e,0===this.ioCallbackPending.length&&e()})),this.ioCallbackPendingPromise}isUnitHidden(e){let t=this.adUnits.find(t=>t.id===e);return!t||t.isHidden}canUnitRefresh(e,t){let i=this.adUnits.find(t=>t.id===e);return!i||i.canRefresh(this.minimumTimeInViewInMs,t)}refreshedUnits(e){e.map(e=>this.getObservedUnit(e)).map(e=>e.refreshed())}intersectionCallback(e){e.forEach(e=>{let t=e.target.firstElementChild;if(t){let i=t.id,s=this.getObservedUnit(i);e.intersectionRatio>=this.viewportThreshold?s.cameIntoView():s.removedFromView(),s.setHidden(this.isEntryHidden(e)),this.removeWaitingForCallbackElement(i)}})}isEntryHidden(e){let{boundingClientRect:t}=e;return this.isBoundingRectHidden(t)}isBoundingRectHidden(e){return 0===e.height&&0===e.width}getElementById(e){return document.getElementById(e)||(console.error(`[AdObserver] could not find element with id ${e}`),null)}getObservedUnit(e){let t=this.adUnits.find(t=>t.id===e);if(!t)throw Error("[AdObserver] observed unit not found");return t}pageLostFocus(){this.adUnits.map(e=>e.pageLostFocus()),this.invokeCallBacks(!1)}pageRegainedFocus(){this.adUnits.map(e=>e.pageRegainedFocus()),this.invokeCallBacks(!0)}invokeCallBacks(e){this.pageFocusChangeCallBacks.forEach(t=>t(e))}createObserver(){return new IntersectionObserver((e,t)=>{this.intersectionCallback(e)},{threshold:[this.viewportThreshold]})}installEventListeners(){void 0!==this.hiddenKey&&document.addEventListener(this.getVisibilityChangeKey(this.hiddenKey),this.handleVisibilityChange),this.installFullscreenListener()}removeEventListeners(){void 0!==this.hiddenKey&&document.removeEventListener(this.getVisibilityChangeKey(this.hiddenKey),this.handleVisibilityChange),this.removeFullscreenListeners()}installFullscreenListener(){k.A.addFullscreenListener(this.handleFullscreenChange),k.A.addFakeFullscreenListener(this.handleFullscreenChange)}removeFullscreenListeners(){k.A.removeFullscreenListener(this.handleFullscreenChange),k.A.removeFakeFullscreenListener(this.handleFullscreenChange)}removeWaitingForCallbackElement(e){this.ioCallbackPending=this.ioCallbackPending.filter(t=>t!==e),0===this.ioCallbackPending.length&&this.ioCallbackPendingResolve&&(this.ioCallbackPendingResolve(),this.ioCallbackPendingResolve=null)}isHidden(e,t){switch(t){case"hidden":return e.hidden;case"msHidden":return!!this.hasMsHiddenKey(e)&&e.msHidden;case"webkitHidden":return!!this.hasWebkitHiddenKey(e)&&e.webkitHidden}}hasMsHiddenKey(e){return"boolean"==typeof e.msHidden}hasWebkitHiddenKey(e){return"boolean"==typeof e.webkitHidden}}var F=i(78766),E=i(68044);let R=function(e,t){let i=window.setTimeout(e,t);return()=>clearTimeout(i)};class L{constructor(e,t,i=R){this.disposed=!1,this.timerFactory=i,this.timerPeriod=e,this.onEvent=t,this.timeRemaining=0}restart(){this.disposed||(this.clearCurrent(),this.startTimer(this.timerPeriod))}startTimer(e){this.timerDisposer=this.timerFactory(()=>{this.timerDisposer=void 0,this.onEvent()},e),this.timeStarted=this.now(),this.currentTimeout=e}pause(){if(this.disposed||!this.isRunning())return;this.clearCurrent();let e=this.now()-this.timeStarted;this.timeRemaining=this.currentTimeout-e}resume(e){if(this.disposed||this.isRunning())return;let t=void 0!==e?e:this.timeRemaining;t<=0?(this.timeRemaining=this.currentTimeout,this.onEvent(),this.isRunning()||this.restart()):this.startTimer(t)}dispose(){this.disposed=!0,this.clearCurrent()}clearCurrent(){void 0!==this.timerDisposer&&(this.timerDisposer(),this.timerDisposer=void 0)}isRunning(){return void 0!==this.timerDisposer}now(){return Date.now()}}class I{constructor(e,t,i){this.timeOfLastRefresh=0,this.timeOfMount=0,this.eventHandlerMemory={gamePlayStarted:!1},this.handleMessageEvent=e=>{if(!e.data||e.data.type!==F.x)return;let t=this.convertToRefreshTimerEvent(e.data);this.handleEvent(t)},this.handleEvent=e=>{let t=function(e,t,i,s,r,n,a,o){if("timerTriggered"===e)return s+(()=>{switch(a.type){case"regular":return a.timeBetweenRefreshes;case"smart":return a.minimumTimeBetweenRefreshes}})()<=1.1*r?{type:"refresh"}:{type:"ignore"};if(!t){switch(n.type){case"startOnMount":return"componentMounted"===e?{type:"restartTimer"}:{type:"ignore"};case"waitUntilAfterGameLoading":if("gameFinishedLoading"===e||"gameLoadingStateResponseSuccess"===e){let e=r-i,t=n.minimumWaitTimeAfterPageLoad;if(e>=t)return{type:"refresh"};return{type:"resumeTimer",customTimeout:Math.max(0,t-e)}}}return{type:"ignore"}}if("smart"===a.type)switch(e){case"adFinished":case"gameplayStart":if(o.gamePlayStarted)break;return o.gamePlayStarted=!0,{type:"restartTimer"};case"rewardedAd":case"midgameAd":case"gameplayStop":if(!o.gamePlayStarted)break;if(o.gamePlayStarted=!1,r-s>=a.minimumTimeBetweenRefreshes)return{type:"refresh"}}return{type:"ignore"}}(e,this.timer.isRunning(),this.timeOfMount,this.timeOfLastRefresh,Date.now(),this.startMomentConfig,this.refreshConfig,this.eventHandlerMemory);this.onAction(t)},this.refreshAds=e,this.timer=new L(function(e){switch(e.type){case"smart":return e.maximumTimeBetweenRefreshes;case"regular":return e.timeBetweenRefreshes}}(i),()=>this.handleEvent("timerTriggered")),this.startMomentConfig=t,this.refreshConfig=i}refresh(){this.refreshAds()?(this.timeOfLastRefresh=Date.now(),this.timer.restart()):this.timer.resume()}handleExternalEvent(e){switch(e.type){case"focusChanged":return e.hasFocus?this.onAction({type:"refresh"}):this.onAction({type:"pauseTimer"}),!0;case"initialAdsRequestFinished":return"startOnMount"===this.startMomentConfig.type&&this.onAction({type:"restartTimer"}),!0;case"mounted":return this.init(),this.handleEvent("componentMounted"),!0;case"willUnmount":return this.dispose(),!0}}getMinimumTimeInDOMBeforeRefresh(){return this.refreshConfig.minimumTimeInDOM}init(){this.requiresGameEventListener()&&(window.addEventListener("message",this.handleMessageEvent),"waitUntilAfterGameLoading"===this.startMomentConfig.type&&E.y()?.contentWindow?.postMessage("check-loading-state","*")),this.timeOfMount=Date.now()}dispose(){this.timer.dispose(),this.requiresGameEventListener()&&window.removeEventListener("message",this.handleMessageEvent)}requiresGameEventListener(){return"smart"===this.refreshConfig.type||"waitUntilAfterGameLoading"===this.startMomentConfig.type}onAction(e){switch(e.type){case"restartTimer":return this.timer.restart(),!0;case"pauseTimer":return this.timer.pause(),!0;case"resumeTimer":return this.timer.resume(),!0;case"refresh":return this.refresh(),!0;case"ignore":return!0}}convertToRefreshTimerEvent(e){return"gameLoadingStateResponse"===e.event?e.success?"gameLoadingStateResponseSuccess":"gameLoadingStateResponseFailure":e.event}}let U={regular:{minTimeBetweenConsecutiveRefreshes:3e4,maxTimeBetweenConsecutiveRefreshes:51e3,minTimeInDom:2e4},highlyAffectedSystems:{minTimeBetweenConsecutiveRefreshes:3e4,maxTimeBetweenConsecutiveRefreshes:15e4,minTimeInDom:2e4}},x=[{browsers:["safari"],os:[]}];function S(e){return e?e.toLowerCase().replace(/\s/g,""):"unknown"}var B=i(80394);class M{constructor(e){this.bidderAttemptsWithoutBid={},this.biddersToDisable={},this.onRequestAdsResult=(e,t,i)=>{if(i)for(let s of e.codes??[]){let r=this.extractEnabledBiddersForAdUnitFromRequest(s,e,t);this.updateBidderAttemptsWithoutBid(s,i,r),delete this.biddersToDisable[s]}},this.getBiddersToDisable=e=>{let t=this.bidderAttemptsWithoutBid[e];if(!this.biddersToDisable[e]){if(t){let i=Object.keys(t).filter(e=>{let i=t[e];return void 0!==i&&i>=this.numberOfBidAttempts});this.biddersToDisable[e]=i}else this.biddersToDisable[e]=[]}return this.biddersToDisable[e]},this.reset=()=>{this.bidderAttemptsWithoutBid={},this.biddersToDisable={}},this.getCurrentNumberOfAttemptsWithoutBid=(e,t)=>{let i=this.bidderAttemptsWithoutBid[e];if(void 0===i)return 0;let s=i[t];return void 0===s?0:s},this.numberOfBidAttempts=e}extractEnabledBiddersForAdUnitFromRequest(e,t,i){let s={};return(i.bidders||[]).forEach(e=>{s[e.bidder]={...e}}),(t.units.find(t=>t.adUnit.code===e)?.bidders||[]).forEach(e=>{s[e.bidder]={...s[e.bidder],...e}}),Object.values(s).filter(e=>e.enabled&&"google"!==e.bidder).map(e=>e.bidder)}updateBidderAttemptsWithoutBid(e,t,i){let s=this.bidderAttemptsWithoutBid[e]||{},r=(t[e]?.bids??[]).map(e=>e.bidder);i.forEach(e=>{r.includes(e)?s[e]=0:s[e]=(s[e]||0)+1}),this.bidderAttemptsWithoutBid[e]=s}}class D{constructor(e){this.adsLibraryLoaded=!1,this.adsConfigLoaded=!1,this.userInfoLoaded=!1,this.consent=!1,this.config=null,this.userInfo=null,this.shouldWaitForConsent=e}handleAction(e){switch(e.type){case"adsLibraryLoaded":return this.onAdsLibraryLoaded();case"adsConfigLoaded":return this.onAdsConfigLoaded(e);case"consentGiven":return this.onConsentGiven();case"userInfoLoaded":return this.onUserInfoLoaded(e)}}retrieveState(){return this.adsLibraryLoaded&&this.adsConfigLoaded&&this.userInfoLoaded&&this.consent&&null!==this.config&&null!==this.userInfo?{ready:!0,userInfo:this.userInfo,config:this.config,consent:!0}:{ready:!1,userInfo:this.userInfo,config:this.config,consent:this.consent}}onAdsLibraryLoaded(){return this.adsLibraryLoaded=!0,this.retrieveState()}onAdsConfigLoaded(e){return this.adsConfigLoaded=!0,this.config=e.config,this.retrieveState()}onConsentGiven(){return this.consent=!0,this.retrieveState()}onUserInfoLoaded(e){return(this.userInfoLoaded=!0,this.userInfo=e.userInfo,this.shouldWaitForConsent(e.userInfo.countryCode))?this.retrieveState():this.onConsentGiven()}}var O=i(64996),P=i(22018),V=i(30804);let H=!1,q=e=>{let{pageUrlHelper:t,dispatch:i,resetLibrary:s,adsLoaderContext:r}=e,[n]=(0,o.useState)(s),a=o.useContext(V.H).czyDynamicPriceFloorVariantsCZY_14537,d=(0,o.useContext)(O.A).services,l=r.adsLoader,h=r.initAds,u=function(e){if(!(0,P.O)(e))return!1;switch(e){case"portal":case"portalandgameframe":return!0;case"gameframe":case"disabled":return!1}}(a);return o.useEffect(()=>{let e=()=>{let e=window;if(n&&e.CrazygamesAds.reset(),!H){try{h(),d.crazyAnalyticsService.adsFinishedLoading(),d.analyticsService.checkAdblock()}catch{console.debug("Failed to initialize ads, likely due to an adblocker."),d.analyticsService.detectedAdblock()}H=!0}i({type:"adsLibraryLoaded"})};return l.loadCrazyAds(t,u),l.addLoadListener(e),()=>l.removeLoadListener(e)},[t,i,n,d,l,h,u]),null},G=e=>{let{dispatch:t}=e,i=(0,o.useContext)(O.A).services.adUnitService;return(0,o.useEffect)(()=>{void 0!==i&&i.getAdUnitsConfig().then(e=>t({type:"adsConfigLoaded",config:e}))},[t,i]),null};var _=i(80362);let W=e=>{let{dispatch:t}=e;return o.useEffect(()=>{let e=()=>t({type:"consentGiven"}),i=(0,_.b)();return i.addConsentListener(e),()=>i.removeConsentListener(e)},[t]),null},K=e=>{let{dispatch:t}=e,i=(0,o.useContext)(O.A).services.userInfoService;return o.useEffect(()=>{i.getUserInfo().then(e=>{t({type:"userInfoLoaded",userInfo:e})})},[i,t]),null};var z=i(65363);let N=[i(34458).R.RightMpuRefresh];class ${constructor(e){this.attemptsWithoutBid={},this.numberOfBidAttempts=e,N.forEach(e=>{this.attemptsWithoutBid[e]=0})}unitEligibleForAdsense(e){return N.includes(e)}onRender(e,t){N.includes(e)&&(this.attemptsWithoutBid[e]=t?(this.attemptsWithoutBid[e]??0)+1:0)}getHasAdsense(e){return(this.attemptsWithoutBid[e]??0)>=this.numberOfBidAttempts}}function j(){throw Error("[AdContext] No Advertising Context")}let X=o.createContext({addAdUnit:e=>j(),removeAdUnit:(e,t)=>j(),adblock:!1});var J=function(e){return e.ANDROID="android",e.IOS="ios",e.WINDOWS="windows",e.MAC="macos",e.LINUX="linux",e.CHROMIUM="chromiumos",e.UBUNTU="ubuntu",e.UNKNOWN="unknown",e.OTHER="other",e}(J||{});let Z={GB:.2,US:.2},Y=["army","battle-royale","battleship","bloody","bomberman","cannon","first-person-shooter","gta","gun","horde-survival","hunting","jump-scare","killing","mmo","police","scary","shooting","sniper","soldier","surgery","survive","tank","third-person-shooter","war"],Q=null;class ee extends o.Component{static #e=this.isFirstRequest=!0;constructor(e){super(e),this.countryCode=null,this.deviceInfo=null,this.disabledCountries=["RU","VE","BY"],this.disabledBidderTracker=new M(5),this.adsenseUnitTracker=new $(1),this.mounted=!1,this.disabled=!1,this.dispatchLoadingAction=e=>{if(!this.mounted)return;let t=this.advertisingLoadingModel.handleAction(e);this.setState({loadingModelState:t})},this.getCountryCode=()=>this.countryCode,this.addAdUnit=e=>{!this.adUnits.find(t=>t.id===e.id)&&(this.adUnits.push(e),this.observer&&this.adConfig&&this.addUnitToObserver(e))},this.removeAdUnit=(e,t)=>{this.adUnits=this.adUnits.filter(t=>t.id!==e.id),this.observer&&this.adConfig&&this.removeUnitFromObserver(e,t)},this.requestAndRenderAds=()=>{if(!this.observer)return!1;let e=[],t=this.getRefreshTimer();this.firstPageRequest?e=this.adUnits.filter(e=>!this.observer.isUnitHidden(e.id)):null!=t&&(e=this.adUnits.filter(e=>this.observer.canUnitRefresh(e.id,t.getMinimumTimeInDOMBeforeRefresh())));let i=e.map(e=>e.id),s=this.adUnitsRequestConfig();if(0===s.length||0===i.length)return!0;let r={units:s,codes:i},n=window.CrazygamesAds;if(void 0===n)return e.forEach(e=>e.onRender(!0)),!1;let a=this.requestAdsOptions();return n.requestOnly(r,a).then(async e=>{if(!this.mounted)return;let t=this.renderAds(i);this.disabledBidderTracker.onRequestAdsResult(r,a,e),await t}).catch(e=>console.error(e)),this.firstPageRequest&&(this.firstPageRequest=!1,ee.isFirstRequest=!1,this.getRefreshTimer()?.handleExternalEvent({type:"initialAdsRequestFinished"})),!0},this.pageFocusChangeCallback=e=>{this.mounted&&this.getRefreshTimer()?.handleExternalEvent({type:"focusChanged",hasFocus:e})},this.shouldWaitUntilConsented=e=>(0,f.Td)(e)||(0,f.AL)(e),this.adUnits=[],this.timeInViewInMs=1e4,this.viewPortThreshold=.5,this.observer=null,this.advertisingLoadingModel=new D(e=>(0,g.A)(e,this.props.pageUrlHelper)&&this.shouldWaitUntilConsented(e)),this.state={loadingModelState:this.advertisingLoadingModel.retrieveState()}}componentDidMount(){let{pageUrlHelper:e}=this.props;this.disabled=e.shouldDisableAds()||this.props.disabled||!this.props.deviceType.isDesktop,this.mounted=!0,this.observer=new A(this.viewPortThreshold,this.timeInViewInMs),this.firstPageRequest=!0,this.resetBiddersToDisableInterval=window.setInterval(()=>{this.resetBiddersToDisable()},9e5)}componentWillUnmount(){this.mounted=!1,this.getRefreshTimer()?.handleExternalEvent({type:"willUnmount"}),this.observer&&(this.observer.stop(),this.observer=null);let e=window;e.CrazygamesAds&&e.CrazygamesAds.nextPage&&e.CrazygamesAds.nextPage(),window.clearInterval(this.resetBiddersToDisableInterval)}componentDidUpdate(e,t,i){let s=this.state.loadingModelState;if(s.ready&&(null===this.adConfig||void 0===this.adConfig)){if(this.adConfig=s.config,this.countryCode=s.userInfo.countryCode,this.deviceInfo=s.userInfo.device,this.inDisabledCountry(this.countryCode))return;this.initRefreshTimer(),this.addUnitsToObserver(),this.toRequestAds()}}render(){return(0,a.jsxs)(a.Fragment,{children:[!this.disabled&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(q,{dispatch:this.dispatchLoadingAction,pageUrlHelper:this.props.pageUrlHelper,resetLibrary:!ee.isFirstRequest,adsLoaderContext:this.props.adsLoaderContext}),(0,a.jsx)(G,{dispatch:this.dispatchLoadingAction}),(0,a.jsx)(K,{dispatch:this.dispatchLoadingAction}),(0,a.jsx)(W,{dispatch:this.dispatchLoadingAction})]}),(0,a.jsx)(X.Provider,{value:{addAdUnit:this.addAdUnit,removeAdUnit:this.removeAdUnit,adblock:!1},children:this.props.children})]})}inDisabledCountry(e){return!e||this.disabledCountries.some(t=>t===e)}async toRequestAds(){await this.requestAds(),this.mounted&&this.addObserverCallbacks()}async requestAds(){if(0!==this.adUnitsRequestConfig().length&&(await this.observer.waitForObservedUnitsCallbacks(),this.mounted))return this.requestAndRenderAds()}requestAdsOptions(){let{dollarRate:e,priceFloor:t,...i}=this.adConfig.advertising,s=this.getTimeout(),r=this.adConfig.bidders.map(e=>this.mapApiConfigToBidderConfig(e)),n=this.isLoggedIn(),a=this.getPriceFloor()||t,o=this.getUserDetails(),l=window.location.origin+window.location.pathname;return{...i,priceFloor:n&&a?1.3*a:a,bidders:r,timeout:s,trafficSource:this.trafficSource(),user:o,pageUrl:l,ortb2Site:this.ortb2SiteConfig(l),clientInfo:{country:this.getCountryCode(),locale:(0,d.uo)(this.props.locale),browser:this.deviceInfo?.browser.name?.toLowerCase().replace(/\s/g,""),device:(0,p.ZI)(this.props.deviceType)},pageIdentifier:this.props.advertisingGame.gameSlug}}ortb2SiteConfig(e){let t=(this.props.advertisingGame.tagsSlug||[]).filter(e=>-1===Y.indexOf(e));return{page:e,content:{title:this.props.advertisingGame.gameName,url:window.location.href,context:2,userrating:`${this.props.advertisingGame.numLikes}`,sourcerelationship:1,keywords:t.join(",")}}}async renderAds(e){try{let t=this.renderAdsOptions(e);await window.CrazygamesAds.render(e,t)}catch(e){console.error(e)}}renderAdsOptions(e){let t=this.getTimeout(),i=this.adConfig.bidders.find(e=>"google"===e.id),s=i?{googleBidder:{...this.mapApiConfigToBidderConfig(i),enabled:!0}}:{},r={};return e.forEach(e=>{(0,z.z)(e)?r[e]={clearSlotIfEmpty:!0}:r[e]={clearSlotIfEmpty:!1}}),{dfp:this.dfpKeys(),banner:{callback:e=>{var t,i;let{minPrice:s,code:r,empty:n}=e,a=this.props.services;t={analyticsService:a.analyticsService,crazyAnalyticsService:a.crazyAnalyticsService},i={value:s,gameSlug:this.props.advertisingGame.gameSlug},null===h&&(h={timeoutId:window.setTimeout(()=>{for(let e in t.crazyAnalyticsService.bannerAdConversion(h?.totalValue||0),h?.valueByGame)t.analyticsService.trackAdConversion({gameSlug:e,value:h?.valueByGame[e]??0});(function(){if("undefined"==typeof gtag||!h||!h.totalValue)return;let e=h.totalValue;(0,l.requestIdleCallback)(()=>{gtag("event","conversion",{send_to:"AW-312835820/UBOSCNjR06wDEOz9lZUB",value:e,currency:"EUR"})},{timeout:2e3})})(),h=null},1e3),totalValue:0,valueByGame:{}}),h.totalValue=h.totalValue+i.value,h.valueByGame[i.gameSlug]=(h.valueByGame[i.gameSlug]||0)+i.value;let o=this.adUnits.find(e=>e.id===r);void 0!==o&&(this.adsenseExperimentEnabled()&&this.adsenseUnitTracker.unitEligibleForAdsense(o.id)||o.onRender(n),this.adsenseUnitTracker.onRender(o.id,n))},unitOptions:r},requestTimeout:t,...s}}trafficSource(){return(0,C.wg)()?"purchased":"organic"}getPriceFloor(){let e=this.getCountryCode();return e&&Z[e]||null}getTimeout(){return ee.isFirstRequest?2400:2e3}mapApiConfigToBidderConfig(e){let t={bidder:e.id,...e.config};return"adsense"===e.id?{...t,enabled:!1}:{enabled:!0,...t}}adUnitsRequestConfig(){let{units:e}=this.adConfig;return this.adUnits.map(t=>{let i=e.find(e=>e.id===t.id);if(!i)return console.error(`[Advertising] Unexpected id ${t.id}`),null;let s=this.disabledBidderTracker.getBiddersToDisable(t.id),r=i.config.request.bidders.map(e=>s.includes(e.bidder)?{...e,enabled:!1}:"adsense"===e.bidder&&this.adsenseExperimentEnabled()&&this.adsenseUnitTracker.getHasAdsense(t.id)?{...e,enabled:!0}:e);return{adUnit:{mediaTypes:i.definition.mediaTypes,code:t.id},slotId:i.definition.slotId,...i.config.request,bidders:r}}).filter(e=>!!e)}addUnitsToObserver(){this.adUnits.forEach(e=>{this.addUnitToObserver(e)})}addObserverCallbacks(){this.observer.addPageFocusChangeCallback(this.pageFocusChangeCallback)}addUnitToObserver(e){if(!this.getUnitDefinition(e.id)){console.error("Missing definition",e.id);return}this.observer.addElement(e.id)}removeUnitFromObserver(e,t){let i=this.getUnitDefinition(e.id);if(!i){console.error("Missing definition",e.id);return}i.definition.refresh&&this.observer.removeElement(e.id,t)}dfpKeys(){let e;let{pageUrlHelper:t,advertisingGame:i}=this.props,{gameSlug:s,tagsSlug:r,categoryEnSlug:n}=i,a=t.routeData.hostname,o=(0,C.e6)(),d=(0,C.$x)();if(d){let t=new Date(d.date),i=t.getUTCDate().toString().padStart(2,"0"),s=(t.getUTCMonth()+1).toString().padStart(2,"0"),r=t.getUTCFullYear().toString().slice(-2);e=`${d.adGroup}_${i}_${s}_${r}`}let l=this.mapOsToDfpOs(this.deviceInfo?.os.name),h=this.isLoggedIn();return{domain:a,advertising_campaign:o,pwa:`${(0,y.Mu)()}`,category_slug:n,game_slug:s,tags_slug:r.length>0?r:void 0,adgroup_acqdate:e,logged_in:`${h}`,os:l,locale:this.props.locale,...function(){let e=window.innerWidth,t=window.innerHeight;if(b.some(i=>i.width===e&&i.height===t))return{browser_size:`${e}x${t}`}}(),...void 0!==this.props.edgeExperiments.aa_exp_24&&{aa_exp_24:`${this.props.edgeExperiments.aa_exp_24}`},forced_adsense:`${this.adsenseExperimentEnabled()}`}}isLoggedIn(){return!!this.props.userContext.user}mapOsToDfpOs(e){switch(this.getCleanedString(e)){case"unknown":return"unknown";case"android":return"android";case"ios":return"ios";case"windows":return"windows";case"macos":return"macos";case"linux":return"linux";case"chromiumos":return"chromiumos";case"ubuntu":return"ubuntu";default:return"other"}}getUnitDefinition(e){return this.adConfig.units.find(t=>t.id===e)}getRefreshTimer(){return this.refreshTimer||this.initRefreshTimer(),this.refreshTimer}initRefreshTimer(){var e,t;if(!this.deviceInfo||null!==this.refreshTimer&&void 0!==this.refreshTimer)return;let{smartRefresh:i}=this.props,s=this.requestAndRenderAds;this.refreshTimer=(e=this.deviceInfo.os.name,t=this.deviceInfo.browser.name,new I(s,function(e){let t=.05>Math.random();return e.isLowEndDevice&&!t?{type:"waitUntilAfterGameLoading",minimumWaitTimeAfterPageLoad:45e3}:{type:"startOnMount"}}(this.props.device),function(e,t,i){let s=!function(e,t){let i=S(e),s=S(t);for(let e of x){let t=0===e.browsers.length||e.browsers.includes(s),r=0===e.os.length||e.os.includes(i);if(t&&r)return!0}return!1}(e,t)?U.regular:U.highlyAffectedSystems,r=i?.minWaitInMs!==void 0?i.minWaitInMs:s.minTimeBetweenConsecutiveRefreshes,n=i?.maxWaitInMs!==void 0?i.maxWaitInMs:s.maxTimeBetweenConsecutiveRefreshes;return{type:"smart",minimumTimeBetweenRefreshes:Math.min(r,n),maximumTimeBetweenRefreshes:Math.max(r,n),minimumTimeInDOM:s.minTimeInDom}}(e,t,i))),this.refreshTimer.handleExternalEvent({type:"mounted"}),this.firstPageRequest||this.refreshTimer.handleExternalEvent({type:"initialAdsRequestFinished"})}getUserEmail(){if((0,P.O)(this.email))return this.email;let{userContext:e}=this.props,{user:t,loadingUser:i}=e;if(i)return;let s=t?.email?.trim().toLowerCase().replace(/\+[^@]*@/g,"@");return this.email=s,this.email}getUserDetails(){var e;return{email:this.getUserEmail(),amazon:{applicable:(e=this.deviceInfo,null===Q&&(Q=!!e&&["Firefox","Safari","Mobile Safari"].some(t=>(0,p.Bd)(e?.browser,t))),Q)}}}resetBiddersToDisable(){this.disabledBidderTracker.reset()}getCleanedString(e){return e?e.toLowerCase().replace(/\s/g,""):"unknown"}adsenseExperimentEnabled(){return this.props.services.experimentService.getExperimentValueAsBooleanSync("ads_forced_adsense")??!1}}let et=(0,w.A)((0,m.A)((s=e=>{let t=o.useContext(B.B);return(0,a.jsx)(ee,{adsLoaderContext:t,...e})},r=e=>{let t=o.useContext(u.R);return(0,a.jsx)(s,{userContext:t,...e})},n=e=>{let t=o.useContext(v.A);return(0,a.jsx)(r,{device:t,...e})},e=>{let{pageUrlHelper:t}=o.useContext(c.e);return(0,a.jsx)(n,{pageUrlHelper:t,...e})})))},65363:(e,t,i)=>{i.d(t,{z:()=>r});var s=i(34458);function r(e){switch(e){case s.R.RightMpuRefresh:case s.R.LeaderboardBelowGameRefresh:case s.R.SecondLeaderboardBelowGameRefresh:return!0;case s.R.SecondMpuBelowGameRefresh:case s.R.HalfPage300x600BelowGame:return!1;default:throw Error(`Unknown ad unit id: ${e}`)}}},34458:(e,t,i)=>{i.d(t,{R:()=>s});var s=function(e){return e.HalfPage300x600BelowGame="div-gpt-ad-1548853349280-0",e.LeaderboardBelowGameRefresh="div-gpt-ad-1590672385835-0",e.RightMpuRefresh="div-gpt-ad-1590672182999-0",e.SecondLeaderboardBelowGameRefresh="div-gpt-ad-1724075559578-0",e.SecondMpuBelowGameRefresh="div-gpt-ad-1731941770755-0",e}({})},53164:(e,t,i)=>{i.d(t,{R:()=>n});var s=i(96540),r=i(9020);let n=e=>{let{game:t}=e,{setPlayingGame:i,resetGameInvites:n,setGameInviteLink:a}=s.useContext(r.Tz);return s.useEffect(()=>{if(t)return i(t),()=>{i(null),a(null),n()}},[t,n,a,i]),null}},68044:(e,t,i)=>{i.d(t,{u:()=>s,y:()=>r});let s="game-iframe";function r(){return document.getElementById(s)}},71197:(e,t,i)=>{i.d(t,{A:()=>m});var s=i(95420),r=i(77969),n=i(96540),a=i(22672),o=i(78766),d=i(59386),l=i(8056),h=i(9656),u=i(22018);async function c(e){let t=await fetch(e,{method:"GET"});return await t.text()}let m=e=>{let{gameId:t,gameTechnology:i}=e,{user:m}=n.useContext(d.R),g=n.useContext(l.A),f=n.useContext(h.A),[p]=(0,s.n)(a.P),[v]=(0,s.n)(a.kL),[w,b]=(0,r._)(a.IJ),y=n.useRef([]);return n.useEffect(()=>{if(!b.called||b.loading)return;let e=b.data?.gameData;b.error?(y.current.forEach(e=>{e({type:"requestGameDataNone"})}),y.current=[]):e&&e.dataUrl?c(e.dataUrl).then(t=>{let i={...e,data:t};y.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:i,error:b.error}})}),y.current=[]}):(y.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:void 0,error:b.error}})}),y.current=[])},[b]),n.useEffect(()=>{let e=e=>{m?(y.current=[t=>{let i=e.source;i&&i.postMessage(t,"*")},...y.current],w({variables:{id:t,technology:i},fetchPolicy:"network-only"})):y.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:void 0,error:null}})})},s=e=>{let{store:s,version:r,updatedAtTz:n,playedTime:a}=e.data,o=JSON.stringify(s);p({variables:{input:{data:o,id:t,technology:i,version:r,browser:g.browser?.name||"",playedTime:a,deviceType:(0,h.m)(f),updatedAtTz:n}}})},r=e=>{let{version:s}=e.data;v({variables:{input:{id:t,technology:i,version:s,browser:g.browser?.name||"",deviceType:(0,h.m)(f)}}})},n=t=>{if(t.data&&t.data.type===o.x)switch(t.data.event){case"requestGameData":e(t);break;case"updateGameData":case"replaceGameData":(0,u.O)(m)&&s(t);break;case"clearGameData":(0,u.O)(m)&&r(t);break;default:return}};return window.addEventListener("message",n),function(){window.removeEventListener("message",n)}},[p,w,v,t,i,m,g.browser,f]),null}},22672:(e,t,i)=>{i.d(t,{IJ:()=>r,P:()=>n,kL:()=>a});var s=i(90321);let r=i(46961).Hc,n=s.Ru,a=s.Ss},29467:(e,t,i)=>{i.d(t,{A:()=>c});var s=i(77969),r=i(68195),n=i(96540),a=i(78766),o=i(59386),d=i(97307),l=i(59785),h=i(45300),u=i(75782);let c=e=>{let{gameId:t}=e,{user:i}=n.useContext(o.R),{openedDrawer:c}=n.useContext(l.l9),{drawerOpeningPending:m}=n.useContext(l.Cx),{openDrawer:g}=n.useContext(l.lv),[f,p]=(0,s._)(d.Zp),[v,w]=(0,s._)(d.n4),[b,y]=(0,n.useState)(!1),[C,k]=(0,n.useState)(null),{data:T}=(0,r.IT)(d.J_,{skip:!i});(0,n.useEffect)(()=>{if(!m&&b&&C&&(i||c||(y(!1),k(null),C.postMessage({type:"showAuthPromptResponse",data:{error:{code:"userCancelled",message:"User cancelled the auth prompt"}}},"*")),i&&T&&!c)){y(!1),k(null);let e={type:"showAuthPromptResponse",data:{user:{id:T.me.id,username:`${T.me.username}`,profilePictureUrl:`${h.A.Instance.data.images}${T.me.profile.avatar}`}}};C.postMessage(e,"*")}},[c,b,i,C,T,m]);let A=(0,n.useCallback)(async(e,s)=>{let r={type:"requestUserTokenResponse",data:{}};if(!i){r.data={error:{code:"userNotAuthenticated",message:"The user is not authenticated"}},e.postMessage(r,"*");return}if(p.loading)return;let n=await f({variables:{gameId:t,iframeUrl:s},fetchPolicy:"network-only"}),a=n.data?.userToken;n.error||!a?(console.error("User token retrieve error",n.error),r.data={error:{code:"unexpectedError",message:"Failed to retrieve user token"}}):r.data={token:a.token,expiresIn:a.expiresIn},e.postMessage(r,"*")},[i,p.loading,f,t]),F=(0,n.useCallback)(async e=>{let s={type:"requestXsollaUserTokenResponse",data:{}};if(!i){s.data={error:{code:"userNotAuthenticated",message:"The user is not authenticated"}},e.postMessage(s,"*");return}if(w.loading)return;let r=await v({variables:{gameId:t},fetchPolicy:"network-only"}),n=r.data?.xsollaUserToken;if(r.error||!n){console.error("Xsolla user token retrieve error",r.error);let e=r.error?.graphQLErrors?.[0]?.extensions?.code,t=r.error?.graphQLErrors?.[0]?.message;e?s.data={error:{code:e,message:t||""}}:s.data={error:{code:"unexpectedError",message:"Failed to retrieve Xsolla user token"}}}else s.data={token:n.token,expiresIn:n.expiresIn};e.postMessage(s,"*")},[t,v,i,w.loading]);return(0,n.useEffect)(()=>{let e=e=>{let t=()=>{setTimeout(()=>{g("signIn"),y(!0),k(e.source),u.A.removeFakeFullscreenListener(t)},100)};u.A.isFakeFullscreen()?u.A.addFakeFullscreenListener(t):(g("signIn"),y(!0),k(e.source))},t=t=>{if(t.data&&t.data.type===a.x)switch(t.data.event){case"requestUserToken":{let e=t.data;A(t.source,e.iframeUrl);break}case"requestXsollaUserToken":F(t.source);break;case"showAuthPrompt":e(t);break;default:return}};return window.addEventListener("message",t),function(){window.removeEventListener("message",t)}},[t,i,f,g,F,A]),null}},75782:(e,t,i)=>{i.d(t,{A:()=>r});class s{removeFullscreenListener(e){this.eventKeys.forEach(t=>{document.removeEventListener(t,e)})}addFullscreenListener(e){this.eventKeys.forEach(t=>{document.addEventListener(t,e)})}addFakeFullscreenListener(e){this.fakeFullscreenListeners.push(e)}removeFakeFullscreenListener(e){this.fakeFullscreenListeners=this.fakeFullscreenListeners.filter(t=>t!==e)}isFullscreen(){let e=window.document;return!!(e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement)}isFakeFullscreen(){return this.isInFakeFullscreen}enteredFakeFullscreen(){this.isInFakeFullscreen||(this.isInFakeFullscreen=!0,this.fakeFullscreenListeners.forEach(e=>e()))}exitFakeFullscreen(){this.isInFakeFullscreen&&(this.isInFakeFullscreen=!1,this.fakeFullscreenListeners.forEach(e=>e()))}exitNativeFullscreen(){let e=window.document,t=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;return!!t&&(window.document.fullscreenElement&&t.call(e),!0)}constructor(){this.fakeFullscreenListeners=[],this.eventKeys=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],this.isInFakeFullscreen=!1,this.forceLockOrientation=async e=>{if(e&&"BOTH"!==e&&"screen"in window&&window.screen&&window.screen.orientation&&window.screen.orientation.lock)try{await window.screen.orientation.lock("PORTRAIT"===e?"portrait":"landscape")}catch(e){}}}}let r=new s}}]);